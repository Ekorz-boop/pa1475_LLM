<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM RAG Pipeline Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/blocks.css">
    <link rel="stylesheet" href="/static/css/block_content.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/topbar.css">
    <link rel="stylesheet" href="/static/css/canvas.css">
    <link rel="stylesheet" href="/static/css/custom-block-modal.css">
    <link rel="stylesheet" href="/static/css/custom-blocks.css">
    <link rel="stylesheet" href="/static/css/dark-mode.css">
    <link rel="stylesheet" href="/static/css/welcome.css">
    <link rel="stylesheet" href="/static/css/templates.css">
    <link rel="stylesheet" href="/static/css/notifications.css">
    <link rel="stylesheet" href="/static/css/canvas-actions.css">
</head>

<body>
    <div id="app">
        <!-- Add sidebar toggle button -->
        <div id="sidebar-toggle">
            <img src="/static/images/icons/sidebar-menu/hamburger.svg" alt="Menu">
        </div>
        
        <div class="main-content">
            <div id="sidebar">
                <div class="main-menu">
                    <!-- Main Menu Content -->
                    <div class="menu-content" id="main-menu-content">
                        <div class="menu-section">
                            <div class="menu-item" data-menu="blocks">
                                <img src="/static/images/icons/sidebar-menu/blocks.svg" alt="Blocks">
                                <span>Blocks</span>
                            </div>
                            <div class="menu-item" data-menu="templates">
                                <img src="/static/images/icons/sidebar-menu/templates.svg" alt="Templates">
                                <span>Templates</span>
                            </div>
                        </div>
                        
                        <div class="menu-section">
                            <div class="section-title">Theme</div>
                            <div class="theme-options">
                                <div class="theme-option" data-theme="light" title="Light mode">
                                    <img src="/static/images/icons/theme-controls/sun.svg" alt="Light mode" width="16" height="16">
                                </div>
                                <div class="theme-option" data-theme="dark" title="Dark mode">
                                    <img src="/static/images/icons/theme-controls/moon.svg" alt="Dark mode" width="16" height="16">
                                </div>
                                <div class="theme-option" data-theme="system" title="System default">
                                    <img src="/static/images/icons/sidebar-menu/computer.svg" alt="System default" width="16" height="16">
                                </div>
                            </div>
                        </div>
                        
                        <div class="menu-section">
                            <div class="section-title">Canvas Background</div>
                            <div class="bg-color-options">
                                <div class="bg-color-option" data-color="default" title="Default">
                                    <div class="color-preview default-bg"></div>
                                </div>
                                <div class="bg-color-option" data-color="white" title="White">
                                    <div class="color-preview white-bg"></div>
                                </div>
                                <div class="bg-color-option" data-color="light-blue" title="Light Blue">
                                    <div class="color-preview light-blue-bg"></div>
                                </div>
                                <div class="bg-color-option" data-color="light-yellow" title="Light Yellow">
                                    <div class="color-preview light-yellow-bg"></div>
                                </div>
                                <div class="bg-color-option" data-color="light-green" title="Light Green">
                                    <div class="color-preview light-green-bg"></div>
                                </div>
                                <div class="bg-color-option" data-color="light-purple" title="Light Purple">
                                    <div class="color-preview light-purple-bg"></div>
                                </div>
                            </div>
                        </div>

                        <!-- User Menu Section -->
                        {% if current_user.is_authenticated %}
                        <div class="menu-section">
                            <div class="section-title">User</div>
                            {% if current_user.is_admin %}
                            <a href="/admin" class="menu-item" id="admin-button">
                                <img src="/static/images/icons/admin-panel/admin.svg" alt="Admin">
                                <span>Admin Panel</span>
                            </a>
                            {% endif %}
                            <a href="/logout" class="menu-item" id="logout-button">
                                <img src="/static/images/icons/action-buttons/logout.svg" alt="Logout">
                                <span>Logout</span>
                            </a>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Blocks Content -->
                    <div class="menu-content" id="blocks-content">
                        <div class="content-header">
                            <button class="back-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1)"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg>
                            </button>
                            <h3>Blocks</h3>
                        </div>
                        <div class="search-container">
                            <input type="text" id="block-search" placeholder="Search blocks...">
                            <div class="search-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                            </div>
                        </div>
                        <div class="block-templates-container">
                            <div class="custom-blocks-message">
                                <button id="create-custom-block-btn" class="primary-btn">Create Custom Block</button>
                            </div>

                            <!-- Custom blocks section header -->
                            <div id="custom-blocks-section-header" class="custom-blocks-section-header" style="display: none;">
                                <span>Custom Blocks</span>
                                <div class="custom-blocks-divider"></div>
                            </div>

                            <!-- Custom blocks will appear here -->
                            <div id="custom-blocks-container"></div>
                        </div>
                    </div>

                    <!-- Templates Content -->
                    <div class="menu-content" id="templates-content">
                        <div class="content-header">
                            <button class="back-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1)"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg>
                            </button>
                            <h3>Templates</h3>
                        </div>
                        <!-- Templates specific content -->
                        <div class="templates-section">
                            <div class="template-actions-menu">
                                <div id="saveTemplateBtn" class="action-button" title="Save Pipeline Template">
                                    <img src="/static/images/icons/action-buttons/save.svg" alt="Save Template">
                                </div>
                                <div id="loadTemplateBtn" class="action-button" title="Load Pipeline Template">
                                    <img src="/static/images/icons/action-buttons/load.svg" alt="Load Template">
                                </div>
                            </div>
                            <div class="saved-templates-preview">
                                <h4>Recent Templates</h4>
                                <div id="recent-templates-list" class="saved-templates-list">
                                    <p class="no-templates">No saved templates found</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="canvas">
                <div class="canvas-actions">
                    <button id="export-pipeline" class="export-button" title="Export Pipeline">
                        <img src="/static/images/icons/action-buttons/export.svg" alt="Export Pipeline">
                    </button>
                </div>
                <div class="debug-mode-container" title="Enable to run partial pipelines for debugging" style="display: none;">
                    <input type="checkbox" id="debug-mode">
                    <label for="debug-mode">Debug Mode</label>
                </div>
                
                <!-- Welcome Screen -->
                <div id="simple-welcome">
                    <div class="welcome-container">
                        <div class="center-content">
                            <h1 class="title">RAGgie</h1>
                            <p class="subtitle">Create, test and export your RAG pipelines easily</p>
                        </div>
                        <p class="info-text"><span class="text-content">Blocks, Templates and canvas customization</span></p>
                        <p class="info-text"><span class="text-content">Export and download pipeline to python</span></p>
                        <p class="info-text"><span class="text-content">Fit to view</span></p>
                    </div>
                </div>
                
                <div class="canvas-container">
                    <div class="canvas-grid"></div>
                    <svg id="connections"></svg>
                </div>
                <div class="mini-map">
                    <svg class="mini-map-svg" width="100%" height="100%" style="position:absolute;top:0;left:0;"></svg>
                    <div class="mini-map-viewport"></div>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-button" id="zoom-out">−</button>
                    <div class="zoom-level">100%</div>
                    <button class="zoom-button" id="zoom-in">+</button>
                    <button class="zoom-button" id="zoom-fit" title="Reset zoom">⟲</button>
                </div>
                
                <button id="fit-to-view" class="fit-to-view-button" title="Fit all blocks to view">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- JS -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/docstring-handler.js"></script>
    <script src="/static/js/custom-block-handler.js"></script>
    <script src="/static/js/template-handler.js"></script>
    <script src="/static/js/template-button-handler.js"></script>
    <script src="/static/js/fit-to-view.js"></script>
    <script src="/static/js/welcome.js"></script>

    <!-- Add this right after the body opening tag -->
    <div id="notification-system">
        <div id="toast-container"></div>
        <div id="modal-container"></div>
    </div>

    <!-- Add this before the closing body tag -->
    <div id="progress-modal" class="modal">
        <div class="modal-content">
            <h3 id="progress-title">Processing...</h3>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div id="progress-status">Initializing...</div>
        </div>
    </div>
</body>
</html>
