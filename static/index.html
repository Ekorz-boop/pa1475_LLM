<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM RAG Pipeline Builder</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/blocks.css">
    <link rel="stylesheet" href="/static/css/block_content.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/topbar.css">
    <link rel="stylesheet" href="/static/css/canvas.css">
    <link rel="stylesheet" href="/static/css/management_window.css">
    <link rel="stylesheet" href="/static/css/custom-block-modal.css">
    <link rel="stylesheet" href="/static/css/custom-blocks.css">
    <link rel="stylesheet" href="/static/css/dark-mode.css">
</head>
<body>
    <div id="app">
        <div id="notification-banner" class="notification-hidden">
            <span>⚠️ Ollama is not running. Some features will be unavailable.</span>
            <button id="open-management">Open System Management</button>
            <button class="close-notification">×</button>
        </div>
        <div class="main-content">
            <div id="sidebar">
                <div class="main-menu">
                    <div class="menu-item" data-menu="dashboard">
                        <img src="/static/images/icons/Dashboard.svg" alt="Dashboard">
                        <span>Dashboard</span>
                    </div>
                    <div class="menu-item" data-menu="blocks">
                        <img src="/static/images/icons/Blocks.svg" alt="Blocks">
                        <span>Blocks</span>
                    </div>
                    <div class="menu-item" data-menu="templates">
                        <img src="/static/images/icons/Templates.svg" alt="Templates">
                        <span>Templates</span>
                    </div>
                    <div class="bottom-menu">
                        <div class="menu-item" id="management-button" data-menu="system">
                            <img src="/static/images/icons/status.svg" alt="System Status">
                            <span>System Status</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="canvas">
                <button id="run-all" class="run-button" title="Run Pipeline">
                    <img src="/static/images/icons/run.svg" alt="Run Pipeline">
                </button>
                <button id="dark-mode-toggle" class="dark-mode-toggle" title="Toggle Dark Mode">
                    <img src="/static/images/icons/moon.svg" alt="Dark Mode">
                </button>
                <div class="debug-mode-container" title="Enable to run partial pipelines for debugging">
                    <input type="checkbox" id="debug-mode">
                    <label for="debug-mode">Debug Mode</label>
                </div>
                <button id="export-pipeline" class="export-button" title="Export Pipeline">
                    <img src="/static/images/icons/export.svg" alt="Export Pipeline">
                </button>
                <div class="canvas-container">
                    <div class="canvas-grid"></div>
                    <svg id="connections"></svg>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-button" id="zoom-in">+</button>
                    <div class="zoom-level">100%</div>
                    <button class="zoom-button" id="zoom-out">−</button>
                    <button class="zoom-button" id="zoom-fit">⟲</button>
                </div>
            </div>
        </div>

        <!-- Add these sub-menus after the sidebar -->
        <div id="dashboard-menu" class="sub-menu">
            <div class="sub-menu-header">
                <h3>Dashboard</h3>
            </div>
            <!-- Dashboard content here -->
        </div>

        <div id="blocks-menu" class="sub-menu">
            <div class="sub-menu-header">
                <h3>Blocks</h3>
            </div>
            <div class="search-container">
                <input type="text" id="block-search" placeholder="Search blocks...">
            </div>
            <div class="block-templates-container">
                <div class="custom-blocks-message">
                    <h3>Custom Blocks Only</h3>
                    <p>This application now uses only custom blocks created from LangChain components.</p>
                    <p>Click the button below to create a custom block from any LangChain component.</p>
                    <button id="create-custom-block-btn" class="primary-btn">Create Custom Block</button>
                </div>

                <!-- Custom blocks will appear here -->
                <div id="custom-blocks-container"></div>
            </div>
        </div>

        <div id="templates-menu" class="sub-menu">
            <div class="sub-menu-header">
                <h3>Templates</h3>
            </div>
            <!-- Templates content here -->
        </div>

        <!-- Add the management panel HTML directly -->
        <div id="system-management" class="management-panel">
            <div class="management-header">
                <h2>System Status</h2>
                <button class="close-button">×</button>
            </div>

            <div class="management-content">
                <div class="status-items">
                    <div class="status-item">
                        <span class="status-label">Status:</span>
                        <span class="status-value" id="ollama-status">Checking...</span>
                    </div>
                </div>

                <div class="models-list">
                    <h3>Available Models</h3>
                    <div id="ollama-models">Loading models...</div>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/app.js"></script>
    <script src="/static/js/custom-block-handler.js"></script>

    <!-- Add this right after the body opening tag -->
    <div id="notification-system">
        <div id="toast-container"></div>
        <div id="modal-container"></div>
    </div>

    <!-- Add this before the closing body tag -->
    <div id="progress-modal" class="modal">
        <div class="modal-content">
            <h3 id="progress-title">Processing...</h3>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div id="progress-status">Initializing...</div>
        </div>
    </div>

    <style>
    /* Toast Notifications */
    #toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }

    .toast {
        background: white;
        border-radius: 4px;
        padding: 16px;
        margin-bottom: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        max-width: 400px;
        animation: slideIn 0.3s ease;
    }

    .toast.success {
        border-left: 4px solid #4caf50;
    }

    .toast.error {
        border-left: 4px solid #f44336;
    }

    .toast.info {
        border-left: 4px solid #2196f3;
    }

    .toast.warning {
        border-left: 4px solid #ff9800;
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* Progress Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: white;
        padding: 24px;
        border-radius: 8px;
        min-width: 400px;
        text-align: center;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #eee;
        border-radius: 4px;
        margin: 16px 0;
        overflow: hidden;
    }

    .progress-fill {
        width: 0%;
        height: 100%;
        background: #4caf50;
        transition: width 0.3s ease;
    }

    #progress-status {
        color: #666;
        margin-top: 12px;
        font-size: 14px;
    }
    </style>
</body>
</html>
